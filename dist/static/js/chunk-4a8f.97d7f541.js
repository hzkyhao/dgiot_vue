(this.webpackJsonp=this.webpackJsonp||[]).push([["chunk-4a8f"],{"+9kC":function(t,e,a){"use strict";var n=a("xgCE");a.n(n).a},IRQ8:function(t,e,a){var n=a("MT78").extendComponentView({type:"bmap",render:function(t,e,a){var n=!0,i=t.getBMap(),o=a.getZr().painter.getViewportRoot(),r=t.coordinateSystem,s=function(e,i){if(!n){var s=o.parentNode.parentNode.parentNode,l=[-parseInt(s.style.left,10)||0,-parseInt(s.style.top,10)||0];o.style.left=l[0]+"px",o.style.top=l[1]+"px",r.setMapOffset(l),t.__mapOffset=l,a.dispatchAction({type:"bmapRoam"})}};function l(){n||a.dispatchAction({type:"bmapRoam"})}i.removeEventListener("moving",this._oldMoveHandler),i.removeEventListener("zoomend",this._oldZoomEndHandler),i.addEventListener("moving",s),i.addEventListener("zoomend",l),this._oldMoveHandler=s,this._oldZoomEndHandler=l;var c=t.get("roam");c&&"scale"!==c?i.enableDragging():i.disableDragging(),c&&"move"!==c?(i.enableScrollWheelZoom(),i.enableDoubleClickZoom(),i.enablePinchToZoom()):(i.disableScrollWheelZoom(),i.disableDoubleClickZoom(),i.disablePinchToZoom());var p=t.__mapStyle,m=t.get("mapStyle")||{},u=JSON.stringify(m);JSON.stringify(p)!==u&&(Object.keys(m).length&&i.setMapStyle(m),t.__mapStyle=JSON.parse(u)),n=!1}});t.exports=n},"RU/L":function(t,e,a){a("Rqdy");var n=a("WEpk").Object;t.exports=function(t,e,a){return n.defineProperty(t,e,a)}},Rqdy:function(t,e,a){var n=a("Y7ZC");n(n.S+n.F*!a("jmDH"),"Object",{defineProperty:a("2faE").f})},SEkw:function(t,e,a){t.exports={default:a("RU/L"),__esModule:!0}},Suk3:function(t,e,a){var n,i=a("MT78"),o=i.util,r=i.graphic,s=i.matrix;function l(t,e){this._bmap=t,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=e,this._projection=new BMap.MercatorProjection}function c(t,e){return e=e||[0,0],o.map([0,1],function(a){var n=e[a],i=t[a]/2,o=[],r=[];return o[a]=n-i,r[a]=n+i,o[1-a]=r[1-a]=e[1-a],Math.abs(this.dataToPoint(o)[a]-this.dataToPoint(r)[a])},this)}l.prototype.dimensions=["lng","lat"],l.prototype.setZoom=function(t){this._zoom=t},l.prototype.setCenter=function(t){this._center=this._projection.lngLatToPoint(new BMap.Point(t[0],t[1]))},l.prototype.setMapOffset=function(t){this._mapOffset=t},l.prototype.getBMap=function(){return this._bmap},l.prototype.dataToPoint=function(t){var e=new BMap.Point(t[0],t[1]),a=this._bmap.pointToOverlayPixel(e),n=this._mapOffset;return[a.x-n[0],a.y-n[1]]},l.prototype.pointToData=function(t){var e=this._mapOffset;return[(t=this._bmap.overlayPixelToPoint({x:t[0]+e[0],y:t[1]+e[1]})).lng,t.lat]},l.prototype.getViewRect=function(){var t=this._api;return new r.BoundingRect(0,0,t.getWidth(),t.getHeight())},l.prototype.getRoamTransform=function(){return s.create()},l.prototype.prepareCustoms=function(t){var e=this.getViewRect();return{coordSys:{type:"bmap",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:o.bind(this.dataToPoint,this),size:o.bind(c,this)}}},l.dimensions=l.prototype.dimensions,l.create=function(t,e){var a,i=e.getDom();t.eachComponent("bmap",function(t){var o=e.getZr().painter,r=o.getViewportRoot();if("undefined"==typeof BMap)throw new Error("BMap api is not loaded");if(n=n||function(){function t(t){this._root=t}return t.prototype=new BMap.Overlay,t.prototype.initialize=function(t){return t.getPanes().labelPane.appendChild(this._root),this._root},t.prototype.draw=function(){},t}(),a)throw new Error("Only one bmap component can exist");if(!t.__bmap){var s=i.querySelector(".ec-extension-bmap");s&&(r.style.left="0px",r.style.top="0px",i.removeChild(s)),(s=document.createElement("div")).style.cssText="width:100%;height:100%",s.classList.add("ec-extension-bmap"),i.appendChild(s);var c=t.__bmap=new BMap.Map(s),p=new n(r);c.addOverlay(p),o.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}c=t.__bmap;var m=t.get("center"),u=t.get("zoom");if(m&&u){var d=new BMap.Point(m[0],m[1]);c.centerAndZoom(d,u)}(a=new l(c,e)).setMapOffset(t.__mapOffset||[0,0]),a.setZoom(u),a.setCenter(m),t.coordinateSystem=a}),t.eachSeries(function(t){"bmap"===t.get("coordinateSystem")&&(t.coordinateSystem=a)})};var p=l;t.exports=p},XZnV:function(t,e,a){var n=a("MT78").extendComponentModel({type:"bmap",getBMap:function(){return this.__bmap},setCenterAndZoom:function(t,e){this.option.center=t,this.option.zoom=e},centerOrZoomChanged:function(t,e){var a=this.option;return!(function(t,e){return t&&e&&t[0]===e[0]&&t[1]===e[1]}(t,a.center)&&e===a.zoom)},defaultOption:{center:[104.114129,37.550339],zoom:5,mapStyle:{},roam:!1}});t.exports=n},YEIV:function(t,e,a){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(a("SEkw"));e.default=function(t,e,a){return e in t?(0,n.default)(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}},oAqT:function(t,e,a){var n=a("MT78"),i=a("Suk3");a("XZnV"),a("IRQ8"),n.registerCoordinateSystem("bmap",i),n.registerAction({type:"bmapRoam",event:"bmapRoam",update:"updateLayout"},function(t,e){e.eachComponent("bmap",function(t){var e=t.getBMap(),a=e.getCenter();t.setCenterAndZoom([a.lng,a.lat],e.getZoom())})});e.version="1.0.0"},wAq3:function(t,e,a){t.exports=a.p+"static/img/zetag1.b7ea74d.png"},xgCE:function(t,e,a){},xmIs:function(t,e,a){"use strict";a.r(e);var n=a("YEIV"),i=a.n(n),o=a("m1cH"),r=a.n(o),s=(a("oAqT"),a("t3Un"));a("efpO");var l=a("p46w"),c=a.n(l),p={data:function(){return{dialogTableVisible:!1,activeName:"first",tableData:[],bmapdata:[],formInline:{zetag:"C2",zetagtype:"ZETAG",number:"",status:1},start:0,pagesize:20,total:0,zetagurl:a("wAq3"),readtime:"",nowdata:[],start1:1,pagesize1:5,total1:0,chart:this.$echarts.ECharts,bmap:{},mapZoom:6,plainPath:"path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z",trainIcon:"path://M30.9,53.2C16.8,53.2,5.3,41.7,5.3,27.6S16.8,2,30.9,2C45,2,56.4,13.5,56.4,27.6S45,53.2,30.9,53.2z M30.9,3.5C17.6,3.5,6.8,14.4,6.8,27.6c0,13.3,10.8,24.1,24.101,24.1C44.2,51.7,55,40.9,55,27.6C54.9,14.4,44.1,3.5,30.9,3.5z M36.9,35.8c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H36c0.5,0,0.9,0.4,0.9,1V35.8z M27.8,35.8 c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H27c0.5,0,0.9,0.4,0.9,1L27.8,35.8L27.8,35.8z"}},mounted:function(){this.getCurrentData(),this.$nextTick(function(){setInterval(this.nowtime,1e3)})},methods:{initMap:function(t,e){this.getLineSeries(t),this.getScatterSeries(t),0==t.length?this.effectScatterSeries=[]:this.getEffectScatterSeries(t),this.chart=this.$echarts.init(this.$refs.map),this.chart.setOption({animation:!1,legend:{orient:"vertical",top:30,left:30,data:t.map(function(t){return t.name}),textStyle:{color:"#222222"},selectedMode:"multiple"},bmap:{center:e,zoom:12,roam:!0,scaleLimit:{min:6,max:12}},series:[].concat(r()(this.linesSeries),r()(this.scatterSeries),r()(this.effectScatterSeries))}),this.bmap=this.chart.getModel().getComponent("bmap").getBMap(),this.bmap.setMinZoom(6),this.bmap.setMaxZoom(24),this.bmap.addControl(new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT}));var a=this;this.bmap.addEventListener("zoomend",function(){a.mapZoom=a.bmap.getZoom()})},getLineSeries:function(t){var e=this,a=[];t.forEach(function(n){var o;a.push((o={name:n.name,type:"lines",coordinateSystem:"bmap",silent:!0,polyline:!0,lineStyle:{color:n.primaryColor},effect:{show:!0,period:15,trailLength:.02,symbol:e.plainPath,symbolSize:20,color:"blue"}},i()(o,"lineStyle",{color:"green",normal:{width:1,opacity:1,curveness:.3}}),i()(o,"z",3),i()(o,"data",[{coords:[t[0].stations[0].value,t[0].stations[t[0].stations.length-1].value],lineStyle:{normal:{type:"dashed",color:"#ff4400",width:4,opacity:.6}}}]),o))}),this.linesSeries=a},getScatterSeries:function(t){var e=[];t.forEach(function(t){e.push({name:t.name,type:"scatter",coordinateSystem:"bmap",symbol:"circle",symbolSize:6,z:2,label:{normal:{formatter:"{b}",color:"green",show:!0},emphasis:{show:!0}},itemStyle:{normal:{color:"white",borderColor:"black",borderWidth:1}},data:t.stations})}),this.scatterSeries=e},getEffectScatterSeries:function(t){var e=[],a=c.a.get("language"),n=[t[0].stations[t[0].stations.length-1]].map(function(t){var e="{p3|\n "+("zh"==a?"当前位置":"Latest location")+"}\n                           {p4|\n"+("zh"==a?"经度":"longitude")+" "+t.value[0].toFixed(6)+"},"+("zh"==a?"纬度":"latitude")+t.value[1].toFixed(6);return{name:t.zetagid,itemStyle:{normal:{color:"red"},emphasis:{color:"red"}},label:{normal:{formatter:e,rich:{img:{backgroundColor:{image:t.screenshot}}}}},value:t.value}});e.push({name:"路径",type:"effectScatter",coordinateSystem:"bmap",symbol:this.trainIcon,symbolSize:[10,10],legendHoverLink:!0,z:20,effectType:"ripple",rippleEffect:{period:2,scale:5,brushType:"fill"},label:{normal:{show:!0,position:["500%","100%"],distance:20,color:"#222222",align:"left",backgroundColor:"#FFFFFF",borderRadius:5,padding:10,shadowColor:"rgba(0,0,0,0.16)",shadowBlur:6,shadowOffsetX:0,shadowOffsetY:3,width:250,rich:i()({p3:{fontSize:14,color:"#222222",lineHeight:18}},"p3",{fontSize:14,color:"#222222",lineHeight:18})},emphasis:{show:!0}},data:n}),this.effectScatterSeries=e},timestampToTime:function(t){var e=new Date(1e3*t);return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+((e.getDate()+1<=10?"0"+e.getDate():e.getDate())+" ")+((e.getHours()+1<=10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()+1<=10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()+1<=10?"0"+e.getSeconds():e.getSeconds())},cacuLonLat:function(t){var e=parseInt(t),a=parseInt(60*(t-e));return e+"°"+a+"′"+parseInt(3600*(t-e)-60*a)+"″"},nowtime:function(){var t=Date.parse(new Date),e=new Date(t),a=e.getFullYear()+"-",n=(e.getMonth()+1<=10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",i=(e.getDate()+1<=10?"0"+e.getDate():e.getDate())+" ",o=(e.getHours()+1<=10?"0"+e.getHours():e.getHours())+":",r=(e.getMinutes()+1<=10?"0"+e.getMinutes():e.getMinutes())+":",s=e.getSeconds()+1<=10?"0"+e.getSeconds():e.getSeconds();this.readtime=a+n+i+o+r+s},onSubmit:function(){},handleSizeChange:function(t){this.pagesize=t,this.getCurrentData()},handleCurrentChange:function(t){this.start=(t-1)*this.pagesize,this.getCurrentData()},getCurrentData:function(){var t=this;(function(t,e,a){return Object(s.a)({url:"zeta/etag/tag/topn",method:"get",params:{limit:t,skip:e,status:a}})})(this.pagesize,this.start,this.formInline.status).then(function(e){t.nowdata=e.trace,t.total=e.count}).catch(function(e){t.$message.error(e.error)})},getZeTag:function(t){var e=this;""==t?this.getCurrentData():(this.nowdata=[],function(t,e){return Object(s.a)({url:"zeta/etag/"+t,method:"get",params:{status:e}})}(t,this.formInline.status).then(function(t){t&&(e.nowdata.push(t),e.total=e.nowdata.length)}).catch(function(t){e.$message.error(t.msg)}))},unique:function(t){for(var e=0;e<t.length;e++)for(var a=e+1;a<t.length;a++)t[e].lat==t[a].lat&&t[e].long==t[a].long&&(t.splice(a,1),a--);return t},objSort:function(t){return function(e,a){var n=e[t],i=a[t];return n<i?-1:n>i?1:0}},getZetTagHistroy:function(t,e,a){var n=this;this.start1=1,this.pagesize1=5,this.tableData=[],this.bmapdata=[],function(t,e,a){return Object(s.a)({url:"zeta/etag/history/"+t,method:"get",params:{limit:e,timestamp:a}})}(t,e,a+1800).then(function(e){if(e){var a={name:"",stations:[],primaryColor:"#A56743",bgColor:"#EDE1D9"},i=0,o=0,r=n.unique(e.trace);r=r.sort(n.objSort("timestamp")),a.name=t,r.map(function(t){a.stations.push({value:[t.lat,t.long],name:t.apuid}),i+=t.lat,o+=t.long}),e.trace.map(function(e,a){e.zetagid=t,n.tableData.push(e)}),n.tableData=n.tableData.reverse();var s=(i/e.trace.length).toFixed(6),l=(o/e.trace.length).toFixed(6);n.bmapdata.push(a),n.total1=e.trace.length,n.initMap(n.bmapdata,[s,l])}}).catch(function(t){n.$message.error(t.msg)})},resetForm:function(){},locusSearch:function(t,e){this.dialogTableVisible=!0,this.getZetTagHistroy(t,50,e)},handleSizeChange1:function(t){this.start1=1,this.pagesize1=t},handleCurrentChange1:function(t){this.start1=t}}},m=(a("+9kC"),a("KHd+")),u=Object(m.a)(p,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"zetadevices"},[a("div",{staticClass:"zetaheader"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.formInline,size:"small"}},[a("el-form-item",{attrs:{label:t.$t("zetadevices.terminaltype")}},[a("el-select",{attrs:{placeholder:t.$t("zetadevices.terminaltype")},model:{value:t.formInline.zetagtype,callback:function(e){t.$set(t.formInline,"zetagtype",e)},expression:"formInline.zetagtype"}},[a("el-option",{attrs:{label:"ZETAGLabel",value:"ZETAG"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("zetadevices.terminalmodel")}},[a("el-select",{model:{value:t.formInline.zetag,callback:function(e){t.$set(t.formInline,"zetag",e)},expression:"formInline.zetag"}},[a("el-option",{attrs:{label:"ZETAG AP",value:"AP",disabled:""}}),t._v(" "),a("el-option",{attrs:{label:"ZETAG C1",value:"C1",disabled:""}}),t._v(" "),a("el-option",{attrs:{label:"ZETAG C2",value:"C2"}}),t._v(" "),a("el-option",{attrs:{label:"ZETAG P1",value:"P1",disabled:""}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("zetadevices.labelnumber")}},[a("el-input",{attrs:{placeholder:t.$t("zetadevices.labelnumber")},model:{value:t.formInline.number,callback:function(e){t.$set(t.formInline,"number",e)},expression:"formInline.number"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("zetadevices.devicestatus")}},[a("el-select",{attrs:{placeholder:t.$t("zetadevices.devicestatus")},model:{value:t.formInline.status,callback:function(e){t.$set(t.formInline,"status",e)},expression:"formInline.status"}},[a("el-option",{attrs:{label:t.$t("zetadevices.open"),value:1}}),t._v(" "),a("el-option",{attrs:{label:t.$t("zetadevices.close"),value:0}})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.getZeTag(t.formInline.number)}}},[t._v(t._s(t.$t("developer.search")))]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.resetForm}},[t._v(t._s(t.$t("zetadevices.reset")))])],1)],1)],1),t._v(" "),a("div",{staticClass:"zetacontent"},t._l(t.nowdata,function(e,n){return a("div",{key:n,staticClass:"zetag"},[a("div",{staticClass:"zetagleft"},[a("img",{attrs:{src:t.zetagurl,alt:""}})]),t._v(" "),a("div",{staticClass:"zetagright"},[a("p",[t._v("\n          "+t._s("ZETAG"+t.$t("zetadevices.label"))+"\n          "),a("span",{staticStyle:{color:"green"}},[t._v(t._s("("+e.zetagid+")"))]),t._v(" "),a("span",{staticStyle:{float:"right"},style:{color:1!=e.status?"green":"red"}},[t._v(t._s(1!=e.status?t.$t("zetadevices.open"):t.$t("zetadevices.close")))])]),t._v(" "),a("p",[a("span",[t._v(t._s(t.$t("zetadevices.model")+":C2"))]),t._v(" "),a("span",{staticStyle:{float:"right"}},[t._v(t._s(t.$t("zetadevices.sendingtimes")+":"+e.times))])]),t._v(" "),a("p",[t._v("\n         "+t._s(t.$t("zetadevices.lastreportingtime"))+"\n          "),a("span",{staticStyle:{color:"#84f"}},[t._v(t._s(t.timestampToTime(e.timestamp)))])]),t._v(" "),a("p",[a("span",{staticStyle:{"vertical-align":"sub"}},[t._v(t._s(t.$t("zetadevices.latestlocation")+":"))]),t._v(" "),a("span",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.locusSearch(e.zetagid,e.timestamp)}}},[t._v(t._s(t.$t("zetadevices.trackquery")))])],1)]),t._v(" "),a("p",[a("span",[t._v("N："+t._s(e.lat.toFixed(6)))]),t._v(" "),a("span",{staticStyle:{"margin-left":"5px"}},[t._v("E："+t._s(e.long.toFixed(6)))])])])])})),t._v(" "),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"page-sizes":[20,40,60,80],"page-size":t.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:t.$t("zetadevices.trackquery"),visible:t.dialogTableVisible},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:t.$t("equipment.chart"),name:"first"}},[a("div",{ref:"map",staticClass:"map",staticStyle:{height:"600px",width:"100%"},attrs:{id:"map"}})]),t._v(" "),a("el-tab-pane",{attrs:{label:t.$t("equipment.table"),name:"second"}},[a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:t.tableData.slice((t.start1-1)*t.pagesize1,t.start1*t.pagesize1)}},[a("el-table-column",{attrs:{label:t.$t("equipment.serialnumber"),type:"index",align:"center",width:"100",index:function(e){return e+1+(t.start1-1)*t.pagesize1}}}),t._v(" "),a("el-table-column",{attrs:{property:"zetagid",label:t.$t("equipment.devicenumber"),align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("zetadevices.positioninformation"),align:"center",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v("N："+t._s(Number(e.row.lat).toFixed(6)))]),t._v(" "),a("span",{staticStyle:{"margin-left":"5px"}},[t._v("E："+t._s(Number(e.row.long).toFixed(6)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("zetadevices.reportingtime"),align:"center",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t.timestampToTime(e.row.timestamp)))])]}}])})],1),t._v(" "),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"page-sizes":[5,20,30,40],"page-size":t.pagesize1,layout:"total, sizes, prev, pager, next, jumper",total:t.total1},on:{"size-change":t.handleSizeChange1,"current-change":t.handleCurrentChange1}})],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogTableVisible=!1}}},[t._v(t._s(t.$t("devloper.cancel")))]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogTableVisible=!1}}},[t._v(t._s(t.$t("devloper.determine")))])],1)],1)],1)},[],!1,null,"4c7622ce",null);u.options.__file="zetadevices.vue";e.default=u.exports}}]);