(this.webpackJsonp=this.webpackJsonp||[]).push([["chunk-67f9"],{"17L3":function(e,t,n){"use strict";var a=n("ULR0");n.n(a).a},"2oai":function(e,t,n){"use strict";n.r(t);var a=n("gDS+"),s=n.n(a),o=n("v0iw"),i=n.n(o);n("URgk"),n("t3Un");var l,r=n("Yh9x"),c=n("t/Le"),d=n("MPjy"),u=n("xiB2"),p={data:function(){return{dialogVisible:!1,isopen:"suo",pwdType:"password",tableData:[],channelForm:!1,channelupdated:"新增",activeName:"first",channelId:"",channelformsearch:{name:""},channelregion:[],addchannel:{region:"",desc:""},addrules:{name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]},length:10,start:0,total:0,selectregion:{},resourceid:"",resoucetype:"",description:"",detailchannel:"",subdialog:!1,value4:"",subdialogid:"",subdialogtimer:null,channelname:""}},mounted:function(){this.Get_Re_Channel(0),this.dialogType()},methods:{inputChange:function(e){console.log(e)},validUrl:function(e,t,n){/^[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/.test(t)?n():n(new Error("需要输入正确的url"))},validPort:function(e,t,n){/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(t)?n():n(new Error("需要输入正确的端口号"))},Get_Re_Channel:function(e){var t=this;0==e&&(this.start=0);var n=i.a.Object.extend("Channel"),a=new i.a.Query(n);a.skip(this.start),a.limit(this.length),a.ascending("-updatedAt"),""!=this.channelformsearch.name&&a.contains("name",this.channelformsearch.name),a.count().then(function(e){t.total=e,a.find().then(function(e){e&&(t.tableData=e)},function(e){"209"==e.code?(t.$message({type:"warning",message:"登陆权限过期，请重新登录"}),t.$router.push({path:"/login"})):119==e.code&&t.$message({type:"error",message:"没有操作权限"})})})},dialogType:function(){var e=this;Object(c.e)().then(function(t){e.channelregion=t})},qyChannel:function(e,t){var n=this;Object(r.i)(e.id,t).then(function(e){e&&n.$message({type:"success",message:"enable"==t?"启用成功":"禁用成功"}),n.Get_Re_Channel(0)}).catch(function(e){n.$message.error(e.error)})},updateChannel:function(e){this.dialogVisible=!0,this.resourceid=e.id,this.detailchannel=e.attributes.config,this.resoucetype=e.attributes.cType,this.description=e.attributes.desc},addchannelForm:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var n={};for(var a in t.addchannel)n[a]=t.addchannel[a];delete n.region,delete n.desc,delete n.type,delete n.isEnable;var s=new(i.a.Object.extend("Channel")),o=i.a.User.current().id,l=new i.a.ACL;l.setReadAccess(o,!0),l.setWriteAccess(o,!0),""!=t.resourceid&&(s.id=t.resourceid),s.set("config",n),s.set("ACL",l),s.set("name",t.addchannel.name),s.set("cType",t.addchannel.region),s.set("desc",t.addchannel.desc),s.set("type",t.addchannel.type.toString()),s.set("isEnable",t.addchannel.isEnable),s.save().then(function(e){e&&(t.$message({type:"success",message:"编辑"==t.channelupdated?"编辑成功":"创建成功"}),t.$refs.addchannel.resetFields(),t.channelForm=!1,t.Get_Re_Channel(0))})}},function(e){Object(d.a)(e)})},deleteChannel:function(e){var t=this,n=new(i.a.Object.extend("Channel"));n.id=e.row.id,n.destroy().then(function(n){t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-"+e.$index].doClose(),t.Get_Re_Channel(0)},function(e){t.$message({type:"error",message:e.message})})},addchanneltype:function(){this.channelForm=!0,this.channelupdated="新增"},handleClose:function(){this.addchannel={},this.channelForm=!1,this.resourceid=""},getChannelEnable:function(e,t){return 1==e.row.attributes.isEnable?"green_active":"red_active"},channelSizeChange:function(e){this.length=e,this.Get_Re_Channel()},channelCurrentChange:function(e){this.start=(e-1)*this.length,this.Get_Re_Channel()},removeauto:function(e){var t=this,n={},a={name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}]};this.channelregion.map(function(s){if(s.cType==e){for(var o in t.selectregion=s,t.selectregion.params)t.selectregion.params[o].default?n[o]=t.selectregion.params[o].default:n[o]="",t.selectregion.params[o].reqiured&&("string"==t.selectregion.params[o].type||"integer"==t.selectregion.params[o].type?a[o]=[{required:!0,trigger:"blur"}]:a[o]=[{required:!0,trigger:"change"}]);n.region=e,n.desc="",n.name="",n.type=t.selectregion.type,n.isEnable=!1}}),this.addchannel=n,this.addchannel.region=e,this.addrules=a},nowtime:function(){var e=Date.parse(new Date),t=new Date(e);t.getFullYear(),t.getMonth(),t.getMonth(),t.getDate(),t.getDate();return(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"+((t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":")+(t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds())+" "},subProTopic:function(e){this.subdialog=!0,this.subdialogid=e.id,this.channelname=e.id,setTimeout(function(){(l=ace.edit("subdialog")).session.setMode("ace/mode/text"),l.setTheme("ace/theme/gob"),l.setReadOnly(!0),l.setOptions({enableBasicAutocompletion:!1,enableSnippets:!0,enableLiveAutocompletion:!0})});var t={topic:"log/channel/"+e.id,qos:2},n=new RegExp("log/channel/"+e.id),a="",o=this;u.a.add_hook(n,function(e){l.session.getLength()>=1e3?a="":a+=o.nowtime()+e+"\n",l.setValue(a),l.gotoLine(l.session.getLength())});var i=s()({action:"start_logger"});u.a.subscribe(t,function(n){if(n.result){console.log(t),console.log("订阅成功");var a={topic:"channel/"+e.id,text:i,retained:!0,qos:2};u.a.sendMessage(a),o.subdialogtimer=window.setInterval(function(){u.a.sendMessage(a)},6e5)}})},stopsub:function(e){var t;t=0==e?s()({action:"stop_logger"}):s()({action:"start_logger"});var n={topic:"channel/"+this.subdialogid,text:t,retained:!0,qos:2};u.a.sendMessage(n)},handleCloseSubdialog:function(){var e=s()({action:"stop_logger"}),t={topic:"channel/"+this.subdialogid,text:e,retained:!0,qos:2};u.a.sendMessage(t),this.subdialog=!1,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null}}},h=(n("17L3"),n("KHd+")),m=Object(h.a)(p,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"resourcechannel"},[n("h3",[e._v("通道管理")]),e._v(" "),n("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"通道管理("+e.total+")",name:"first"}},[n("div",{staticClass:"firsttable"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.channelformsearch,size:"small"}},[n("el-form-item",[n("el-input",{attrs:{placeholder:e.$t("resource.name")},model:{value:e.channelformsearch.name,callback:function(t){e.$set(e.channelformsearch,"name",t)},expression:"channelformsearch.name"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.Get_Re_Channel(0)}}},[e._v(e._s(e.$t("developer.search")))])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.addchanneltype}},[e._v(e._s(e.$t("developer.selectchannel")))])],1)],1),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-class-name":e.getChannelEnable}},[n("el-table-column",{attrs:{label:e.$t("developer.channelnumber")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.channelname")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.name))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.channeltype")},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.attributes.type?n("span",[e._v(e._s(e.$t("developer.collectionchannel")))]):n("span",[e._v(e._s(e.$t("developer.resourcechannel")))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.servicetype")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.cType))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.channelstatus")},scopedSlots:e._u([{key:"default",fn:function(t){return["ONLINE"==t.row.attributes.status?n("span",{staticStyle:{color:"green"}},[e._v("在线")]):n("span",{staticStyle:{color:"red"}},[e._v("离线")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.channeladdr"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s("channel/"+t.row.id))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.describe")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.desc))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.attributes.isEnable?n("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(n){e.qyChannel(t.row,"enable")}}},[e._v(e._s(e.$t("developer.enable")))]):n("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(n){e.qyChannel(t.row,"disable")}}},[e._v(e._s(e.$t("developer.prohibit")))]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){e.updateChannel(t.row)}}},[e._v("详情")]),e._v(" "),n("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[n("p",[e._v("确定删除这个"+e._s(t.row.attributes.name)+"通道吗？")]),e._v(" "),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v(e._s(e.$t("developer.cancel")))]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){e.deleteChannel(t)}}},[e._v(e._s(e.$t("developer.determine")))])],1),e._v(" "),n("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[e._v(e._s(e.$t("developer.delete")))])],1),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){e.subProTopic(t.row)}}},[e._v("订阅日志")])]}}])})],1),e._v(" "),n("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[n("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.length,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.channelSizeChange,"current-change":e.channelCurrentChange}})],1)],1)]),e._v(" "),n("el-dialog",{attrs:{title:e.channelupdated+"通道",visible:e.channelForm,width:"40%",top:"0","close-on-click-modal":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.channelForm=t}}},[n("el-form",{ref:"addchannel",attrs:{model:e.addchannel,"label-width":"120px",rules:e.addrules}},[n("el-form-item",{attrs:{label:"通道类型",prop:"region"}},[n("el-select",{attrs:{placeholder:"通道类型"},on:{change:e.removeauto},model:{value:e.addchannel.region,callback:function(t){e.$set(e.addchannel,"region",t)},expression:"addchannel['region']"}},e._l(e.channelregion,function(e,t){return n("el-option",{key:t,attrs:{label:e.title.zh,value:e.cType}})}))],1),e._v(" "),n("el-form-item",{attrs:{label:e.$t("developer.channelname"),prop:"name"}},[n("el-input",{attrs:{autocomplete:"off",placeholder:e.$t("developer.channelname")},model:{value:e.addchannel.name,callback:function(t){e.$set(e.addchannel,"name",t)},expression:"addchannel.name"}})],1),e._v(" "),e._l(e.selectregion.params,function(t,a,s){return n("el-col",{key:s,attrs:{span:12}},[n("el-form-item",{attrs:{label:e.selectregion.params[a].title.zh,required:e.selectregion.params[a].required,prop:a}},["string"==e.selectregion.params[a].type?n("el-input",{model:{value:e.addchannel[a],callback:function(t){e.$set(e.addchannel,a,t)},expression:"addchannel[key]"}}):e._e(),e._v(" "),"integer"==e.selectregion.params[a].type?n("el-input",{model:{value:e.addchannel[a],callback:function(t){e.$set(e.addchannel,a,e._n(t))},expression:"addchannel[key]"}}):"boolean"==e.selectregion.params[a].type?n("el-select",{staticClass:"notauto",attrs:{readonly:""},model:{value:e.addchannel[a],callback:function(t){e.$set(e.addchannel,a,t)},expression:"addchannel[key]"}},[n("el-option",{attrs:{label:"是",value:!0}}),e._v(" "),n("el-option",{attrs:{label:"否",value:!1}})],1):e._e()],1)],1)}),e._v(" "),n("el-form-item",{attrs:{label:e.$t("developer.describe")}},[n("el-input",{attrs:{autocomplete:"off",type:"textarea",rows:3,placeholder:e.$t("developer.describe")},on:{change:e.inputChange},model:{value:e.addchannel.desc,callback:function(t){e.$set(e.addchannel,"desc",t)},expression:"addchannel.desc"}})],1)],2),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("developer.cancel")))]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addchannelForm("addchannel")}}},[e._v(e._s(e.$t("developer.determine")))])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"通道详情",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("div",[n("el-row",[n("el-col",{attrs:{span:12}},[e._v("ID:")]),e._v(" "),n("el-col",{attrs:{span:12}},[e._v(e._s(e.resourceid))])],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[e._v("Resource Type:")]),e._v(" "),n("el-col",{attrs:{span:12}},[e._v(e._s(e.resoucetype))])],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[e._v("Description:")]),e._v(" "),n("el-col",{attrs:{span:12}},[e._v(e._s(e.description))])],1),e._v(" "),e._l(e.detailchannel,function(t,a,s){return n("el-row",{key:s},[n("el-col",{attrs:{span:12}},[e._v(e._s(t))]),e._v(" "),n("el-col",{attrs:{span:12}},[e._v(e._s(a))])],1)})],2),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)]),e._v(" "),n("el-dialog",{attrs:{title:e.channelname+"日志",visible:e.subdialog,"before-close":e.handleCloseSubdialog,width:"85%"},on:{"update:visible":function(t){e.subdialog=t}}},[n("div",{staticStyle:{"margin-top":"20px"}},[n("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px",width:"100%"},attrs:{id:"subdialog"}},[e._v("                    "),n("textarea",{staticClass:"ace_text-input",staticStyle:{overflow:"scroll"}}),e._v("\n                    ")])]),e._v(" "),n("span",{staticClass:"dialog-footer",staticStyle:{height:"30px"},attrs:{slot:"footer"},slot:"footer"},[n("el-switch",{staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","inactive-text":"自动刷新"},on:{change:e.stopsub},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}})],1)])],1)],1)},[],!1,null,"757a7846",null);m.options.__file="resourcechannel.vue";t.default=m.exports},MPjy:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var a=n("X3IP");function s(e){"209"==e.code?(Object(a.Message)({message:"您权限过期,请重新登录",type:"error",duration:2e3}),sessionStorage.removeItem("roles"),sessionStorage.removeItem("username"),sessionStorage.removeItem("token"),sessionStorage.removeItem("list"),location.href="/#/login"):119==e.code?Object(a.Message)({message:"没有操作权限",type:"warning",duration:2e3}):Object(a.Message)({message:e.message,type:"error"})}},ULR0:function(e,t,n){},URgk:function(e,t,n){(function(e){var a=void 0!==e&&e||"undefined"!=typeof self&&self||window,s=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(s.call(setTimeout,a,arguments),clearTimeout)},t.setInterval=function(){return new o(s.call(setInterval,a,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(a,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n("YBdB"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("yLpj"))},YBdB:function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var a,s=1,o={},i=!1,l=e.document,r=Object.getPrototypeOf&&Object.getPrototypeOf(e);r=r&&r.setTimeout?r:e,"[object process]"==={}.toString.call(e.process)?a=function(e){t.nextTick(function(){d(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&d(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),a=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){d(e.data)},a=function(t){e.port2.postMessage(t)}}():l&&"onreadystatechange"in l.createElement("script")?function(){var e=l.documentElement;a=function(t){var n=l.createElement("script");n.onreadystatechange=function(){d(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():a=function(e){setTimeout(d,0,e)},r.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return o[s]=i,a(s),s++},r.clearImmediate=c}function c(e){delete o[e]}function d(e){if(i)setTimeout(d,0,e);else{var t=o[e];if(t){i=!0;try{!function(e){var t=e.callback,a=e.args;switch(a.length){case 0:t();break;case 1:t(a[0]);break;case 2:t(a[0],a[1]);break;case 3:t(a[0],a[1],a[2]);break;default:t.apply(n,a)}}(t)}finally{c(e),i=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n("yLpj"),n("8oxB"))},"t/Le":function(e,t,n){"use strict";n.d(t,"e",function(){return s}),n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return l}),n.d(t,"f",function(){return r}),n.d(t,"d",function(){return c}),n.d(t,"g",function(){return d});var a=n("t3Un");function s(){return Object(a.a)({url:"/resource_types",method:"get",params:{}})}function o(e,t,n,s){return Object(a.a)({url:"/rules",method:"post",data:{actions:e,ctx:t,description:n,rawsql:s}})}function i(){return Object(a.a)({url:"/rules",method:"get",params:{}})}function l(e){return Object(a.a)({url:"/rule/"+e,method:"get",params:{}})}function r(e){return Object(a.a)({url:"/rule/"+e,method:"delete",params:{}})}function c(e,t,n,s){return Object(a.a)({url:"/rule_resource",method:"post",data:{config:e,description:t,name:n,type:s}})}function d(e,t,n,s,o,i){return Object(a.a)({url:"/rule_test",method:"post",data:{actions:e,ctx:t,description:n,for:s,name:o,rawsql:i}})}}}]);