(this.webpackJsonp=this.webpackJsonp||[]).push([["chunk-5336"],{"0Fdp":function(e,t,n){"use strict";n.r(t);var l,s,r=n("gDS+"),a=n.n(r),i=n("t/Le"),o=n("v0iw"),c=n.n(o),u=n("MPjy"),m={data:function(){return{dialogVisible:!1,resourceform:{objectId:"",region:"data_resource",desc:""},resourcerule:{objectId:[{required:!0,message:"请填写通道编号",trigger:"blur"}],desc:[{required:!0,message:"请填写通道描述",trigger:"blur"}]},row1:24,row2:0,dialogFormVisible:!1,title:"",formInline:{user:"",region:"",enginesql:"",remarks:"",sqltest:!1,clientid:"c_swqx",username:"u_swqx",qos:1,topic:"t/a",payload:"",result:""},formlinerule:{region:[{required:!0,message:"请选择触发事件",trigger:"change"}],enginesql:[{required:!0,message:"请填写规则SQL",trigger:"blur"}]},actionData:[],form:{action:"data_to_resource",resource:""},formrule:{action:[{required:!0,message:"请选择动作",trigger:"change"}]},productid:"",resourcelist:[],channellist:[],ctype:"",client:[],sqlexample:"SELECT\n        payload.msg as msg\n      FROM\n        \"t/#\"\n      WHERE\n        msg = 'hello'",actionslist:[],allChannelstart:0,allChannellength:10,allChanneltotal:0}},mounted:function(){this.title=this.$route.query.title,this.productid=this.$route.query.productid,(l=ace.edit("editor1")).session.setMode("ace/mode/sql"),l.setTheme("ace/theme/eclipse"),l.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),l.setValue("SELECT\n        payload.msg as msg\n      FROM\n        \"t/#\"\n      WHERE\n        msg = 'hello'"),(s=ace.edit("editor2")).session.setMode("ace/mode/json"),s.setTheme("ace/theme/eclipse"),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),s.setValue('{"msg":"hello"}')},methods:{getEditor2:function(e){1==e?(this.row1=12,this.row2=12):(this.row1=24,this.row2=0)},selectResource:function(e){},selectaction:function(e){},openDialog:function(){this.dialogVisible=!0},addData:function(){this.dialogFormVisible=!1},relationChannel:function(e){this.actionData.push({name:"data_to_resource",params:{$resource:"channel:"+e}})},allChannelSizeChange:function(e){this.allChannellength=e,this.showAllChannel()},allChannelCurrentChange:function(e){this.allChannelstart=(e-1)*this.allChannellength,this.showAllChannel()},showAllChannel:function(){var e=this,t=c.a.Object.extend("Channel"),n=new c.a.Query(t);n.skip(this.allChannelstart),n.limit(this.allChannellength),n.count().then(function(t){e.allChanneltotal=t,n.find().then(function(t){e.channellist=t})},function(e){Object(u.a)(e)})},testRule:function(e){var t=this;this.formInline.result="",this.formInline.payload=s.getValue(),this.formInline.enginesql=l.getValue(),this.$refs[e].validate(function(e){if(e){var n={clientid:t.formInline.clientid,payload:s.getValue(),qos:t.formInline.qos,topic:t.formInline.topic,username:t.formInline.username};Object(i.g)(t.actionData,n,t.formInline.remarks,l.getValue().match(/from[^"]+?"([^"]+)"/im)[1],"",l.getValue()).then(function(e){t.formInline.result=a()(e,null,4)}).catch(function(e){t.$message.error(e.error)})}})},addrules:function(e){var t=this;this.formInline.payload=s.getValue(),this.formInline.enginesql=l.getValue(),this.$refs[e].validate(function(e){if(e){if(0==t.actionData.length)return void t.$message.error("动作不能为空");var n={clientid:t.formInline.clientid,payload:s.getValue(),qos:t.formInline.qos,topic:t.formInline.topic,username:t.formInline.username};Object(i.a)(t.actionData,n,t.formInline.remarks,l.getValue()).then(function(e){e&&(t.$message.success("创建成功"),t.$router.push({path:"/rules_engine/engine"}))}).catch(function(e){t.$message.error(e)})}else t.$message.error("有必填项未填写")})},addresouce:function(){this.dialogFormVisible=!0,this.showAllChannel()},addRes:function(e){var t=this;this.$refs[e].validate(function(n){if(!n)return t.$message,error("error submit!!"),!1;Object(i.d)({channel:t.resourceform.objectId},t.resourceform.desc,"","data_resource").then(function(n){n&&(t.$message.success("创建成功"),t.$refs[e].resetFields(),t.dialogVisible=!1)})})},deleteOneData:function(e){this.actionData.splice(e,1)}}},d=(n("ApoY"),n("KHd+")),f=Object(d.a)(m,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"addengine"},[n("div",{staticClass:"addcontent"},[n("el-card",{staticClass:"box-card"},[n("el-form",{ref:"formInline",attrs:{model:e.formInline,"label-width":"80px",rules:e.formlinerule,size:"medium"}},[n("div",{staticClass:"form-block__title"},[e._v("\n          "+e._s(e.$t("rule.condtion"))+"\n          "),n("div",{staticClass:"form-block__title-tips"},[e._v(e._s(e.$t("rule.Processing")))])]),e._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:e.row1}},[n("el-form-item",[n("div",{staticClass:"show-guess"},[n("p",[e._v(e._s(e.$t("rule.RuleSQLexample")))]),e._v(" "),n("div",{staticClass:"code"},[n("code",{staticStyle:{"font-size":"12px"}},[e._v(e._s(e.sqlexample))])])])]),e._v(" "),n("el-form-item",{attrs:{label:e.$t("rule.RuleSQL"),prop:"enginesql"}},[n("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor1"}},[n("el-input",{staticClass:"ace_text-input",attrs:{type:"textarea"},model:{value:e.formInline.enginesql,callback:function(t){e.$set(e.formInline,"enginesql",t)},expression:"formInline.enginesql"}})],1)]),e._v(" "),n("el-form-item",{attrs:{label:e.$t("rule.Remarks")}},[n("el-input",{attrs:{type:"text"},model:{value:e.formInline.remarks,callback:function(t){e.$set(e.formInline,"remarks",t)},expression:"formInline.remarks"}})],1),e._v(" "),n("el-form-item",{attrs:{label:e.$t("rule.SQLtest")}},[n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"gray"},on:{change:e.getEditor2},model:{value:e.formInline.sqltest,callback:function(t){e.$set(e.formInline,"sqltest",t)},expression:"formInline.sqltest"}}),e._v(" "),n("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:"自定义模拟数据进行 SQL 命令测试，仅用于测试功能"}},[n("i",{staticClass:"el-icon-question",staticStyle:{color:"#71737d"},attrs:{slot:"reference"},slot:"reference"})])],1)],1),e._v(" "),n("el-col",{attrs:{span:4}}),e._v(" "),n("el-col",{staticClass:"animated fadeInRightBig",attrs:{span:e.row2}},[n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.formInline.sqltest,expression:"formInline.sqltest==true"}],attrs:{label:"clientid",prop:"clientid",rules:[{required:!0,message:"clientid 不能为空",trigger:"blur"}]}},[n("el-input",{model:{value:e.formInline.clientid,callback:function(t){e.$set(e.formInline,"clientid",t)},expression:"formInline.clientid"}})],1),e._v(" "),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.formInline.sqltest,expression:"formInline.sqltest==true"}],attrs:{label:"username",prop:"username",rules:[{required:!0,message:"username 不能为空",trigger:"blur"}]}},[n("el-input",{model:{value:e.formInline.username,callback:function(t){e.$set(e.formInline,"username",t)},expression:"formInline.username"}})],1),e._v(" "),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.formInline.sqltest,expression:"formInline.sqltest==true"}],attrs:{label:"topic",prop:"topic",rules:[{required:!0,message:"topic 不能为空",trigger:"blur"}]}},[n("el-input",{model:{value:e.formInline.topic,callback:function(t){e.$set(e.formInline,"topic",t)},expression:"formInline.topic"}})],1),e._v(" "),1==e.formInline.sqltest?n("el-form-item",{attrs:{label:"qos",prop:"qos",rules:[{required:!0,message:"qos 不能为空",trigger:"blur"}]}},[n("el-input",{model:{value:e.formInline.qos,callback:function(t){e.$set(e.formInline,"qos",e._n(t))},expression:"formInline.qos"}})],1):e._e(),e._v(" "),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.formInline.sqltest,expression:"formInline.sqltest==true"}],attrs:{label:"payload",prop:"payload",rules:[{required:!0,message:"请填写payload",trigger:"blur"}]}},[n("el-input",{staticStyle:{visibility:"hidden"},attrs:{type:"text"},model:{value:e.formInline.payload,callback:function(t){e.$set(e.formInline,"payload",t)},expression:"formInline.payload"}}),e._v(" "),n("pre",{staticClass:"ace_editor",staticStyle:{"min-height":"300px"},attrs:{id:"editor2"}},[n("el-input",{staticClass:"ace_text-input",attrs:{type:"textarea"},model:{value:e.formInline.payload,callback:function(t){e.$set(e.formInline,"payload",t)},expression:"formInline.payload"}})],1)],1),e._v(" "),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.formInline.sqltest,expression:"formInline.sqltest==true"}],attrs:{label:" "}},[n("el-button",{attrs:{type:"success"},on:{click:function(t){e.testRule("formInline")}}},[e._v(e._s(e.$t("rule.Test")))])],1),e._v(" "),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.formInline.sqltest,expression:"formInline.sqltest==true"}],attrs:{label:e.$t("rule.TestJie")}},[n("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.formInline.result,callback:function(t){e.$set(e.formInline,"result",t)},expression:"formInline.result"}})],1)],1)],1),e._v(" "),n("div",{staticClass:"tablebottom"},[n("div",{staticClass:"form-block__title"},[n("span",{staticStyle:{color:"rgb(255, 109, 109)"}},[e._v("*")]),e._v("\n            "+e._s(e.$t("rule.ResponseAction"))+"\n            "),n("div",{staticClass:"form-block__title-tips"},[e._v(e._s(e.$t("rule.Processing")))])]),e._v(" "),n("div",{staticClass:"bottomtable",staticStyle:{"padding-left":"20px"}},[n("div",{staticClass:"tableaction"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.actionData}},[n("el-table-column",{attrs:{prop:"name",label:e.$t("rule.Type"),width:"180"}}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("rule.Parameter")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.params.$resource?n("span",[e._v(e._s("关联资源:"+t.row.params.$resource))]):n("span")]}}])}),e._v(" "),n("el-table-column",{attrs:{width:"180",label:e.$t("developer.operation")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(n){e.deleteOneData(t.$index)}}},[e._v("删除")])]}}])})],1),e._v(" "),n("div",[n("el-button",{staticStyle:{"margin-top":"20px"},attrs:{type:"success",plain:"",icon:"el-icon-circle-plus-outline",size:"small"},on:{click:e.addresouce}},[e._v(e._s(e.$t("rule.Addto")))])],1)],1)]),e._v(" "),n("div",[n("el-dialog",{attrs:{title:e.$t("rule.ResponseAction"),visible:e.dialogFormVisible,width:"60%",top:"1vh","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.channellist,height:"400"}},[n("el-table-column",{attrs:{label:e.$t("developer.channelnumber"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.channelname"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.name))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.servicetype"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.cType))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("developer.operation"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){e.relationChannel(t.row.id)}}},[e._v(e._s(e.$t("developer.add")))])]}}])})],1),e._v(" "),n("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[n("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.allChannellength,layout:"total, sizes, prev, pager, next, jumper",total:e.allChanneltotal},on:{"size-change":e.allChannelSizeChange,"current-change":e.allChannelCurrentChange}})],1)],1)],1)]),e._v(" "),n("el-form-item",{attrs:{"label-width":"0"}},[n("el-button",{attrs:{type:"success"},on:{click:function(t){e.addrules("formInline")}}},[e._v("新建")]),e._v(" "),n("el-button",[e._v("取消")])],1)],1)],1)],1)])},[],!1,null,"7b757028",null);f.options.__file="addengine.vue";t.default=f.exports},ApoY:function(e,t,n){"use strict";var l=n("E0sy");n.n(l).a},E0sy:function(e,t,n){},MPjy:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var l=n("X3IP");function s(e){"209"==e.code?(Object(l.Message)({message:"您权限过期,请重新登录",type:"error",duration:2e3}),sessionStorage.removeItem("roles"),sessionStorage.removeItem("username"),sessionStorage.removeItem("token"),sessionStorage.removeItem("list"),location.href="/#/login"):119==e.code?Object(l.Message)({message:"没有操作权限",type:"warning",duration:2e3}):Object(l.Message)({message:e.message,type:"error"})}},"t/Le":function(e,t,n){"use strict";n.d(t,"e",function(){return s}),n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"f",function(){return o}),n.d(t,"d",function(){return c}),n.d(t,"g",function(){return u});var l=n("t3Un");function s(){return Object(l.a)({url:"/resource_types",method:"get",params:{}})}function r(e,t,n,s){return Object(l.a)({url:"/rules",method:"post",data:{actions:e,ctx:t,description:n,rawsql:s}})}function a(){return Object(l.a)({url:"/rules",method:"get",params:{}})}function i(e){return Object(l.a)({url:"/rule/"+e,method:"get",params:{}})}function o(e){return Object(l.a)({url:"/rule/"+e,method:"delete",params:{}})}function c(e,t,n,s){return Object(l.a)({url:"/rule_resource",method:"post",data:{config:e,description:t,name:n,type:s}})}function u(e,t,n,s,r,a){return Object(l.a)({url:"/rule_test",method:"post",data:{actions:e,ctx:t,description:n,for:s,name:r,rawsql:a}})}}}]);