(this.webpackJsonp=this.webpackJsonp||[]).push([["chunk-029f"],{"35y/":function(e,t,a){},MPjy:function(e,t,a){"use strict";a.d(t,"a",function(){return l});var r=a("X3IP");function l(e){"209"==e.code?(Object(r.Message)({message:"您权限过期,请重新登录",type:"error",duration:2e3}),sessionStorage.removeItem("roles"),sessionStorage.removeItem("username"),sessionStorage.removeItem("token"),sessionStorage.removeItem("list"),location.href="/#/login"):119==e.code?Object(r.Message)({message:"没有操作权限",type:"warning",duration:2e3}):Object(r.Message)({message:e.message,type:"error"})}},"P/Mu":function(e,t,a){},"RU/L":function(e,t,a){a("Rqdy");var r=a("WEpk").Object;e.exports=function(e,t,a){return r.defineProperty(e,t,a)}},Rqdy:function(e,t,a){var r=a("Y7ZC");r(r.S+r.F*!a("jmDH"),"Object",{defineProperty:a("2faE").f})},SEkw:function(e,t,a){e.exports={default:a("RU/L"),__esModule:!0}},XXUv:function(e,t,a){"use strict";var r=a("gDS+"),l=a.n(r),i=a("YEIV"),s=a.n(i),n=a("v0iw"),o=a.n(n),u=(a("72z0"),{name:"Pumpdepartment",props:["regiondata"],data:function(){var e;return e={search:"",defaultProps:{isLeaf:"leaf",children:"children",label:"name"},data:[],node:[],treeData1:[],data1:[]},s()(e,"node",[]),s()(e,"resolve",[]),e},watch:{},computed:{treeData:function(){var e=JSON.parse(l()(this.data1));return e.filter(function(t){var a=e.filter(function(e){return t.objectId==e.ParentId});return a.length>0&&(t.children=a),0==t.ParentId})}},mounted:function(){console.log(this.data1)},methods:{reset:function(){this.search=""},handleNodeClick:function(e){this.$emit("pumpDetail",e)},getOrgList:function(e,t){var a=this;if(0===e.level){this.data=[];var r=o.a.Object.extend("Department");(l=new o.a.Query(r)).equalTo("ParentId","0"),l.find().then(function(e){return e.map(function(e){var t={};e.createtime=new Date(e.attributes.createdAt).toLocaleDateString(),t.name=e.attributes.name,t.ParentId=e.attributes.ParentId,t.objectId=e.id,t.level=e.attributes.level,t.createtime=e.createtime,t.leaf=e.attributes.leafnode,t.icon=e.attributes.org_type,t.isvcon=!1,a.data.push(t),a.data1.push(t)}),t(a.data)},function(e){t([]),"209"==e.code?(a.$message({type:"warning",message:"登陆权限过期，请重新登录"}),a.$router.push({path:"/login"})):119==e.code&&a.$message({type:"error",message:"没有操作权限"})})}else if(0!==e.level&&"实验台"!==e.data.icon&&0==e.data.isvcon){this.data=[];var l;r=o.a.Object.extend("Department");(l=new o.a.Query(r)).equalTo("ParentId",e.data.objectId),l.ascending("org_type"),l.limit(1e4),l.find().then(function(e){return e.map(function(e){var t={};e.createtime=new Date(e.attributes.createdAt).toLocaleDateString(),t.name=e.attributes.name,t.ParentId=e.attributes.ParentId,t.objectId=e.id,t.level=e.attributes.level,t.createtime=e.createtime,1==e.attributes.leafnode?t.isvcon=!0:t.isvcon=!1,t.leaf=e.attributes.leafnode,t.icon=e.attributes.org_type,a.data.push(t),a.data1.push(t)}),t(a.data)},function(e){t([]),"209"==e.code?(a.$message({type:"warning",message:"登陆权限过期，请重新登录"}),a.$router.push({path:"/login"})):119==e.code&&a.$message({type:"error",message:"没有操作权限"})})}}}}),d=(a("zbzu"),a("KHd+")),c=Object(d.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"resource1",staticStyle:{"border-left":"38px solid #1579bf","padding-left":"10px"}},[a("div",[a("el-input",{staticStyle:{width:"150px"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("搜索")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.reset}},[e._v("重置")]),e._v(" "),a("el-tree",{ref:"tree",staticStyle:{"margin-top":"20px"},attrs:{props:e.defaultProps,"expand-on-click-node":!1,"highlight-current":!0,lazy:"",load:e.getOrgList,"node-key":"objectId"},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,l=t.data;return a("span",{},["质检中心"==l.icon?a("svg-icon",{staticStyle:{width:"20px",height:"20px"},attrs:{"icon-class":"质检中心"}}):"泵单位"==l.icon?a("svg-icon",{staticStyle:{width:"20px",height:"20px"},attrs:{"icon-class":"水泵企业"}}):"实验室"==l.icon?a("svg-icon",{staticStyle:{width:"20px",height:"20px"},attrs:{"icon-class":"实验室"}}):e._e(),e._v(" "),a("span",{staticStyle:{"padding-left":"4px"}},[e._v(e._s(r.label))])],1)}}])})],1)])},[],!1,null,null,null);c.options.__file="pumpdepartment.vue";t.a=c.exports},YEIV:function(e,t,a){"use strict";t.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(a("SEkw"));t.default=function(e,t,a){return t in e?(0,r.default)(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}},bQqV:function(e,t,a){"use strict";a.r(t);var r=a("XXUv"),l=a("MPjy"),i=a("v0iw"),s=a.n(i),n=a("t3Un");a("Yfch");var o={components:{Pumpdepartment:r.a},data:function(){return{formInline:{unumber:"",status:"all",laboratory:""},tableData:[],dialogFormVisible:!1,formLabelWidth:"120px",ushieldform:{name:"",unumber:"",bidunit:"",issueunit:"",phone:"",ukey:"",startdate:"",enddate:"",address:"",company:"",username:""},ushieldrule:{name:[{required:!0,message:"申办人姓名不能为空",trigger:"blur"}],unumber:[{required:!0,message:"U盾序列号不能为空",trigger:"blur"}],bidunit:[{required:!0,message:"申办单位名称不能为空",trigger:"blur"}],startdate:[{required:!0,message:"发证日期不能为空",trigger:"blur"}],address:[{required:!0,message:"申办单位地址不能为空",trigger:"blur"}]},companylist:[],personlist:[],pagesize:10,start:0,total:0,ushieldid:""}},mounted:function(){this.getUshield()},methods:{getUshield:function(e){var t=this;0==e&&(this.start=0);var a=s.a.Object.extend("Devices"),r=new s.a.Query(a);r.skip(this.start),r.limit(this.pagesize),r.equalTo("basedata.type","ukey"),r.count().then(function(e){t.total=e,r.find().then(function(e){t.tableData=e})},function(e){Object(l.a)(e)})},editorUdun:function(e){var t=this;this.ushieldid=e.id,this.dialogFormVisible=!0;var a=s.a.Object.extend("Devices");new s.a.Query(a).get(this.ushieldid).then(function(e){t.ushieldform.unumber=e.attributes.basedata.SerialNumber,t.ushieldform.name=e.attributes.basedata.Subject,t.ushieldform.startdate=e.attributes.basedata.beforeDate,t.ushieldform.enddate=e.attributes.basedata.afterDate,t.ushieldform.bidunit=e.attributes.basedata.Issuer,t.ushieldform.ukey=e.attributes.basedata.bstrCertB64},function(e){Object(l.a)(e)})},uShield:function(){var e=this;this.dialogFormVisible=!0,this.ushieldid="",Object(n.a)({url:"/cert",method:"get",params:{}}).then(function(t){t&&(e.ushieldform.unumber=t.result.data.SerialNumber,e.ushieldform.name=t.result.data.Subject,e.ushieldform.startdate=t.result.data.beforeDate,e.ushieldform.enddate=t.result.data.afterDate,e.ushieldform.bidunit=t.result.data.Issuer,e.ushieldform.ukey=t.result.data.bstrCertB64)}).catch(function(t){e.$message.error(t.error)})},getCompany:function(){var e=this,t=s.a.Object.extend("Authentication"),a=new s.a.Query(t);a.equalTo("status","Pass"),a.find().then(function(t){e.companylist=t},function(e){Object(l.a)(e)})},getPerson:function(){var e=this,t=s.a.Object.extend("PersonAuthtication"),a=new s.a.Query(t);a.equalTo("status","Pass"),a.find().then(function(t){e.personlist=t},function(e){Object(l.a)(e)})},addUshield:function(){var e=this,t=s.a.Object.extend("Product"),a=new s.a.Query(t);a.equalTo("devType","ukey"),a.find().then(function(a){var r=s.a.Object.extend("Devices"),i=new r,n=new s.a.Query(r);n.equalTo("basedata.SerialNumber",e.ushieldform.unumber),n.find().then(function(r){if(0==r.length){""!=e.ushieldid&&(i.id=e.ushieldid);s.a.Object.extend("Product");var n=new t;n.id=a[0].id,i.set("product",n),i.set("basedata",{SerialNumber:e.ushieldform.unumber,Subject:e.ushieldform.name,beforeDate:e.ushieldform.startdate,afterDate:e.ushieldform.enddate,Issuer:e.ushieldform.bidunit,bstrCertB64:e.ushieldform.ukey,type:"ukey"}),i.save().then(function(t){t&&(e.$message.success("U盾创建成功"),e.ushieldid="",e.dialogFormVisible=!1)},function(e){Object(l.a)(e)})}else e.$message.error("此U盾已存在")},function(e){Object(l.a)(e)})},function(e){Object(l.a)(e)})}}},u=(a("oHL7"),a("KHd+")),d=Object(u.a)(o,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"u_shield"},[a("Pumpdepartment",{staticStyle:{width:"360px",height:"100vh",overflow:"scroll","flex-shrink":"0",padding:"10px"},on:{pumpDetail:e.getPumpNode}}),e._v(" "),a("div",{staticClass:"u_shieldright",staticStyle:{width:"calc(100% - 360px)",padding:"20px"}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[a("el-form-item",{attrs:{label:"U盾状态分类"}},[a("el-select",{attrs:{placeholder:"U盾状态分类"},model:{value:e.formInline.status,callback:function(t){e.$set(e.formInline,"status",t)},expression:"formInline.status"}},[a("el-option",{attrs:{label:"全部",value:"all"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"应用实验室"}},[a("el-select",{attrs:{placeholder:"应用实验室"},model:{value:e.formInline.laboratory,callback:function(t){e.$set(e.formInline,"laboratory",t)},expression:"formInline.laboratory"}},[a("el-option",{attrs:{label:"全部",value:"all"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"U盾编号"}},[a("el-input",{attrs:{placeholder:"U盾编号"},model:{value:e.formInline.unumber,callback:function(t){e.$set(e.formInline,"unumber",t)},expression:"formInline.unumber"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.reseting}},[e._v("查询")])],1)],1),e._v(" "),a("div",[a("el-button",{attrs:{type:"success",size:"small"},on:{click:e.uShield}},[e._v("U盾扫描")])],1),e._v(" "),a("div",{staticClass:"blocktable"},[a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{label:"U盾序列号",align:"center",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.basedata.SerialNumber))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"300",label:"证书拥有者"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.basedata.Subject))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"300",label:"颁发机构"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.basedata.Issuer))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"300",label:"数据签名","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.basedata.bstrCertB64))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"150",label:"发证时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.basedata.beforeDate))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"150",label:"到期时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.basedata.afterDate))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"100",label:"分配状态"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"200",label:"授权单位"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"200",label:"授权个人"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"200",label:"U盾管理"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"small"},on:{click:function(a){e.editorUdun(t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"small"}})]}}])})],1)],1),e._v(" "),a("div",{staticClass:"blocktable"},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"U盾设备赋权",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"ushieldform",attrs:{model:e.ushieldform,size:"small",rules:e.ushieldrule}},[a("p",{staticStyle:{"border-bottom":"1px solid #cccccc",color:"#409EFF","font-size":"14px",height:"40px","margin-top":"0"}},[e._v("U盾详情信息")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"U盾序列号","label-width":e.formLabelWidth,prop:"unumber"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"U盾序列号，插入U盾自动填充",readonly:""},model:{value:e.ushieldform.unumber,callback:function(t){e.$set(e.ushieldform,"unumber",t)},expression:"ushieldform.unumber"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"证书拥有者","label-width":e.formLabelWidth,prop:"name"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"U盾申办人姓名，U盾扫描后自动录入",readonly:""},model:{value:e.ushieldform.name,callback:function(t){e.$set(e.ushieldform,"name",t)},expression:"ushieldform.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"发证日期","label-width":e.formLabelWidth,prop:"startdate"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"U盾正式适用日期，U盾扫描后自动录入",readonly:""},model:{value:e.ushieldform.startdate,callback:function(t){e.$set(e.ushieldform,"startdate",t)},expression:"ushieldform.startdate"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"颁发机构","label-width":e.formLabelWidth,prop:"bidunit"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"取证设备颁发机构",readonly:""},model:{value:e.ushieldform.bidunit,callback:function(t){e.$set(e.ushieldform,"bidunit",t)},expression:"ushieldform.bidunit"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"到期日期","label-width":e.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"U盾有效期到期日期，U盾扫描后自动录入",readonly:""},model:{value:e.ushieldform.enddate,callback:function(t){e.$set(e.ushieldform,"enddate",t)},expression:"ushieldform.enddate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Ukey证书","label-width":e.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off",type:"textarea",rows:4,placeholder:"请输入Ukey证书信息",readonly:""},model:{value:e.ushieldform.ukey,callback:function(t){e.$set(e.ushieldform,"ukey",t)},expression:"ushieldform.ukey"}})],1)],1)],1),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:""!=e.ushieldid,expression:"ushieldid!=''"}],staticStyle:{"border-bottom":"1px solid #cccccc",color:"#409EFF","font-size":"14px",height:"40px"}},[e._v("U盾认证信息")]),e._v(" "),a("el-row",{directives:[{name:"show",rawName:"v-show",value:""!=e.ushieldid,expression:"ushieldid!=''"}]},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"授权单位","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"请选择通过资质认证的企业"},model:{value:e.ushieldform.company,callback:function(t){e.$set(e.ushieldform,"company",t)},expression:"ushieldform.company"}},e._l(e.companylist,function(e){return a("el-option",{key:e.id,attrs:{label:e.attributes.empower.abbrname,value:e.id}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"授权个人","label-width":e.formLabelWidth}},[a("el-select",{attrs:{autocomplete:"off",placeholder:"请选择通过资质认证的个人"},model:{value:e.ushieldform.username,callback:function(t){e.$set(e.ushieldform,"username",t)},expression:"ushieldform.username"}},e._l(e.personlist,function(e){return a("el-option",{key:e.id,attrs:{label:e.attributes.name,value:e.id}})}))],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addUshield}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"79de7a5c",null);d.options.__file="u_shield.vue";t.default=d.exports},oHL7:function(e,t,a){"use strict";var r=a("P/Mu");a.n(r).a},zbzu:function(e,t,a){"use strict";var r=a("35y/");a.n(r).a}}]);