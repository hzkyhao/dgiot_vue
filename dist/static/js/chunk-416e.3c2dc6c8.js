(this.webpackJsonp=this.webpackJsonp||[]).push([["chunk-416e"],{"4Pqm":function(t,e,r){},J66h:function(module,exports,__webpack_require__){(function(global){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(global,factory){module.exports=function(global){"use strict";var _Base64=(global=global||{}).Base64,version="2.5.1",buffer;if(void 0!==module&&module.exports)try{buffer=eval("require('buffer').Buffer")}catch(t){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(t){for(var e={},r=0,o=t.length;r<o;r++)e[t.charAt(r)]=r;return e}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(t){if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?fromCharCode(192|e>>>6)+fromCharCode(128|63&e):fromCharCode(224|e>>>12&15)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e)}var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return fromCharCode(240|e>>>18&7)+fromCharCode(128|e>>>12&63)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(t){return t.replace(re_utob,cb_utob)},cb_encode=function(t){var e=[0,2,1][t.length%3],r=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0),o=[b64chars.charAt(r>>>18),b64chars.charAt(r>>>12&63),e>=2?"=":b64chars.charAt(r>>>6&63),e>=1?"=":b64chars.charAt(63&r)];return o.join("")},btoa=global.btoa?function(t){return global.btoa(t)}:function(t){return t.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t)).toString("base64")}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t)).toString("base64")}:function(t){return btoa(utob(t))},encode=function(t,e){return e?_encode(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):_encode(String(t))},encodeURI=function(t){return encode(t,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(t){switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),r=e-65536;return fromCharCode(55296+(r>>>10))+fromCharCode(56320+(1023&r));case 3:return fromCharCode((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return fromCharCode((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},btou=function(t){return t.replace(re_btou,cb_btou)},cb_decode=function(t){var e=t.length,r=e%4,o=(e>0?b64tab[t.charAt(0)]<<18:0)|(e>1?b64tab[t.charAt(1)]<<12:0)|(e>2?b64tab[t.charAt(2)]<<6:0)|(e>3?b64tab[t.charAt(3)]:0),a=[fromCharCode(o>>>16),fromCharCode(o>>>8&255),fromCharCode(255&o)];return a.length-=[0,0,2,1][r],a.join("")},_atob=global.atob?function(t){return global.atob(t)}:function(t){return t.replace(/\S{1,4}/g,cb_decode)},atob=function(t){return _atob(String(t).replace(/[^A-Za-z0-9\+\/]/g,""))},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t,"base64")).toString()}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t,"base64")).toString()}:function(t){return btou(_atob(t))},decode=function(t){return _decode(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var t=global.Base64;return global.Base64=_Base64,t};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"==typeof Object.defineProperty){var noEnum=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(t){return encode(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}global.Meteor&&(Base64=global.Base64);void 0!==module&&module.exports?module.exports.Base64=global.Base64:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return global.Base64}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__));return{Base64:global.Base64}}(global)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==global?global:this)}).call(this,__webpack_require__("yLpj"))},Mld3:function(t,e,r){"use strict";r.d(e,"a",function(){return a}),r.d(e,"b",function(){return i}),r.d(e,"c",function(){return s}),r.d(e,"d",function(){return n});var o=r("t3Un");function a(t){var e=t.order,r=t.limit,a=t.skip,i=t.keys,s=t.include,n=t.where;return Object(o.a)({url:"/classes/Project",method:"get",params:{order:e,limit:r,skip:a,keys:i,include:s,where:n}})}function i(t){if("number"==typeof t){t=String(t);var e=/0{8}$/,r=/0{4}$/;return e.test(t)?t.replace(e,"亿"):r.test(t)?t.replace(r,"万"):t}if("string"==typeof t){var o=/万+$/,a=/亿+$/;return a.test(t)?t.replace(a,"00000000"):o.test(t)?t.replace(o,"0000"):t}}function s(t,e,r){return Object(o.a)({url:"/lictool",method:"get",params:{appid:t,appsecret:e,shuwa_iot_software:r}})}function n(t){return Object(o.a)({url:"/licsetup",method:"get",params:{license:t}})}},Pjhv:function(t,e,r){"use strict";var o=r("r0eq");r.n(o).a},R6Mr:function(t,e,r){"use strict";var o=r("4Pqm");r.n(o).a},Ueb3:function(t,e,r){"use strict";r.r(e);var o=r("gDS+"),a=r.n(o),i=r("Mld3"),s=r("v0iw"),n=r.n(s),c=r("J66h").Base64,l={data:function(){return{imageUrl:!1,host:window.location.origin+"/lot/",form:{name:"",options:[],category:"",number:"",code:"",scale:"",dashboard:"",product:[],department:"",scaleDate:[{id:0,value:100,label:"100"},{id:1,value:1e3,label:"1000"},{id:2,value:1e4,label:"1万"},{id:3,value:1e5,label:"10万"},{id:4,value:1e6,label:"100万"},{id:5,value:1e7,label:"1000万"},{id:6,value:1e8,label:"1亿"}],productIdentifier:"",fileList:[],fileList1:[],img:"",img1:"",copyright:"",desc:"",time:7200,secret:""},sessionToken:"",file:"",page:"",content:{title:"",objectId:""},argu:{},Notification:"",productlist:[]}},computed:{treeData:function(){var t=JSON.parse(a()(this.form.options));return t.filter(function(e){var r=t.filter(function(t){return e.id==t.parentid});return r.length>0&&(e.children=r),0==e.parentid})}},created:function(){this.Industry(),this.randomSecret(),this.getProductList(),this.sessionToken=sessionStorage.getItem("token")},mounted:function(){this.estiPage()},methods:{handleClickRefresh:function(){this.randomSecret()},getProductList:function(){var t=this,e=n.a.Object.extend("Product");new n.a.Query(e).find().then(function(e){e&&(t.productlist=e)})},randomSecret:function(){var t=Math.ceil(25*Math.random());this.form.secret=c.encode(String.fromCharCode(65+t)+Math.ceil(1e7*Math.random())+Number(new Date))},estiPage:function(){this.argu=this.$route.query,console.log(this.argu),this.content.title=this.argu.title,this.page=this.argu.page,"update"==this.page&&(this.form.name=this.argu.name,this.form.scale=Number(Object(i.b)(this.argu.scale)),this.form.secret=this.argu.secret,this.form.productIdentifier=this.argu.productIdentifier,this.content.objectId=this.argu.objectId,this.form.department=this.argu.userUnit,this.form.category=this.argu.category.split("/"),this.argu.dashboard?this.form.dashboard=this.argu.dashboard.substr(7):this.form.dashboard="",""!=this.argu.logo&&(this.form.img=this.argu.logo,this.form.fileList.push({name:"logo.png",url:this.argu.logo})),""!=this.argu.background&&(this.form.img1=this.argu.background,this.form.fileList1.push({name:"background.png",url:this.argu.background})))},handleClickBack:function(){this.$router.push({path:"/roles/applicationManagement"})},submitUpload:function(){this.$refs.upload.submit()},handleChangeFile:function(t){var e=t.target.files[0],r=e.name.substr(-3);e.size/1024>500?this.$message.error("上传图片大小不能超过500KB!"):"png"!=r&&"jpg"!=r?this.$message.error("上传图片格式不正确，必须是png或jpg格式！"):this.file=e},handleSuccess:function(t,e,r){this.form.img=t.path,this.$message({message:"上传成功！",type:"success"}),document.getElementsByClassName("el-icon-close")[0].setAttribute("display","none")},handleError:function(t,e,r){this.$message({message:"上传失败！",type:"error"})},isSubmit:function(){return""!=this.form.name&&""!=this.form.scale&&""!=this.form.productIdentifier||(this.$message.error("有必填项没有填写，无法提交！"),!1)},handleSuccess1:function(t,e,r){this.form.img1=t.path,this.$message({message:"上传成功！",type:"success"}),document.getElementsByClassName("el-icon-close")[0].setAttribute("display","none")},submitUpload1:function(){this.$refs.upload1.submit()},handleClickSubmit:function(){var t=this;if(this.isSubmit()){var e=new(n.a.Object.extend("Project")),r=new(n.a.Object.extend("Product")),o=new n.a.ACL;o.setReadAccess(n.a.User.current().id,!0),o.setWriteAccess(n.a.User.current().id,!0),e.set("ACL",o);var a=e.relation("product");this.form.product.map(function(t){r.set("objectId",t),a.add(r)}),e.set("title",this.form.name),e.set("category",this.form.category.join("/")),e.set("scale",this.form.scale),e.set("productIdentifier",this.form.productIdentifier),e.set("copyright",this.form.copyright),e.set("desc",this.form.desc),e.set("logo",this.form.img),e.set("background",this.form.img1),e.set("userUnit",this.form.department),""!=this.form.dashboard?e.set("dashboard","http://"+this.form.dashboard):e.set("dashboard",""),e.save().then(function(e){e&&(t.$message({message:"添加成功！",type:"success"}),t.$router.push({path:"/roles/projectManagement"}))})}},handleClickUpdate:function(){var t=this;if(this.isSubmit()){var e=new(n.a.Object.extend("Project"));e.id=this.argu.objectId;var r=new(n.a.Object.extend("Product")),o=new n.a.ACL;o.setReadAccess(n.a.User.current().id,!0),o.setWriteAccess(n.a.User.current().id,!0),e.set("ACL",o);var a=e.relation("product");this.form.product.map(function(t){r.set("objectId",t),a.add(r)}),e.set("title",this.form.name),e.set("category",this.form.category.join("/")),e.set("scale",this.form.scale),e.set("productIdentifier",this.form.productIdentifier),e.set("copyright",this.form.copyright),e.set("desc",this.form.desc),e.set("logo",this.form.img),e.set("background",this.form.img1),e.set("userUnit",this.form.department),""!=this.form.dashboard?e.set("dashboard","http://"+this.form.dashboard):e.set("dashboard",""),e.save().then(function(e){e&&(t.$message({message:"修改成功！",type:"success"}),t.$router.push({path:"/roles/projectManagement"}))})}},Industry:function(){var t=this;this.form.options=[];var e=n.a.Object.extend("Datas"),r=new n.a.Query(e);r.equalTo("data.key","category"),r.limit(1e3),r.find().then(function(e){e&&e.map(function(e){var r={};r.value=e.attributes.data.CategoryName,r.label=e.attributes.data.CategoryName,r.id=e.attributes.data.Id,r.parentid=e.attributes.data.SuperId,t.form.options.push(r)})},function(e){t.$message.error(e.message)})},open12:function(){this.Notification=this.$notify({title:"面板预览",dangerouslyUseHTMLString:!0,duration:0,type:"success",message:"<div><iframe\n                src='http://"+this.form.dashboard+'\'\n                width="1000"\n                height="400"\n                frameborder="0"\n      ></iframe></div>'})}},beforeDestroy:function(){this.Notification&&this.Notification.close()}},u=(r("R6Mr"),r("Pjhv"),r("KHd+")),d=Object(u.a)(l,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"addApp"}},[r("div",{staticClass:"head"},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/roles/applicationManagement"}}},[t._v(t._s(t.$t("application.applicationmanagement")))]),t._v(" "),r("el-breadcrumb-item",[t._v(t._s(t.$t("route.新增应用")))])],1),t._v(" "),r("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:t.handleClickBack}},[t._v(t._s(t.$t("application.return")))])],1),t._v(" "),r("div",{staticClass:"form"},[r("div",{staticClass:"title"},[r("p",{staticStyle:{color:"#f00"}},[t._v(t._s("*"+t.$t("application.mustfillin")))])]),t._v(" "),r("el-form",{ref:"form",attrs:{model:t.form,"label-width":"180px"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"},[r("el-form-item",{attrs:{label:"应用单位",prop:"department",rules:[{required:!0,message:"应用单位不能为空"}]}},[r("el-input",{attrs:{placeholder:"应用单位"},model:{value:t.form.department,callback:function(e){t.$set(t.form,"department",e)},expression:"form.department"}})],1),t._v(" "),r("el-form-item",{attrs:{label:t.$t("application.applicationname"),prop:"name",rules:[{required:!0,message:"应用名称不能为空"}]}},[r("el-input",{attrs:{placeholder:t.$t("application.applicationname")},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),r("el-form-item",{attrs:{label:t.$t("application.applicationlink"),prop:"productIdentifier",rules:[{required:!0,message:"应用链接不能为空"}]}},[r("el-input",{staticClass:"link",attrs:{placeholder:"例：vcon"},model:{value:t.form.productIdentifier,callback:function(e){t.$set(t.form,"productIdentifier",e)},expression:"form.productIdentifier"}},[r("template",{slot:"prepend"},[t._v(t._s(t.host))])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:t.$t("application.industrytype"),prop:"category",rules:[{required:!0,message:"请选择所属行业",trigger:"blur"}]}},[r("el-cascader",{ref:"category",attrs:{options:t.treeData,placeholder:t.$t("application.industrytype"),clearable:""},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"应用产品"}},[r("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.form.product,callback:function(e){t.$set(t.form,"product",e)},expression:"form.product"}},t._l(t.productlist,function(t,e){return r("el-option",{key:e,attrs:{label:t.attributes.name,value:t.id}})}))],1),t._v(" "),r("el-form-item",{attrs:{label:t.$t("application.applicationdescription")}},[r("el-input",{attrs:{type:"textarea",rows:4,maxlength:"300","show-word-limit":"",placeholder:t.$t("application.applicationdescription")},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1)],1)]),t._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple-light"},[r("el-form-item",{attrs:{label:t.$t("application.applicationpictures")}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"/iotapi/upload","file-list":t.form.fileList,"auto-upload":!1,"list-type":"picture",limit:1,"on-success":t.handleSuccess}},[r("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v(t._s(t.$t("application.selectfile")))]),t._v(" "),r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:t.submitUpload}},[t._v(t._s(t.$t("application.uploadtoserver")))]),t._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:""!=t.form.img,expression:"form.img != ''"}]},[t._v(t._s(t.$t("developer.path"))+":"+t._s(t.form.img))]),t._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.$t("application.onlyJPG/PNGfilescanbeuploadedandnomorethan500kb")))])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"背景图片"}},[r("el-upload",{ref:"upload1",staticClass:"upload-demo",attrs:{action:"/iotapi/upload","file-list":t.form.fileList1,"auto-upload":!1,"list-type":"picture",limit:1,"on-success":t.handleSuccess1}},[r("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v(t._s(t.$t("application.selectfile")))]),t._v(" "),r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:t.submitUpload1}},[t._v(t._s(t.$t("application.uploadtoserver")))]),t._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:""!=t.form.img1,expression:"form.img1 != ''"}]},[t._v(t._s(t.$t("developer.path"))+":"+t._s(t.form.img1))]),t._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.$t("application.onlyJPG/PNGfilescanbeuploadedandnomorethan500kb")))])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:t.$t("application.copyrightinformation")}},[r("el-input",{attrs:{type:"textarea",rows:3,maxlength:"300","show-word-limit":"",placeholder:t.$t("application.copyrightinformation")},model:{value:t.form.copyright,callback:function(e){t.$set(t.form,"copyright",e)},expression:"form.copyright"}})],1),t._v(" "),r("el-form-item",{attrs:{label:t.$t("application.monitoringpanel")}},[r("el-input",{attrs:{placeholder:t.$t("application.monitoringpanel")},model:{value:t.form.dashboard,callback:function(e){t.$set(t.form,"dashboard",e)},expression:"form.dashboard"}},[r("template",{slot:"prepend"},[t._v("http://")]),t._v(" "),r("el-button",{staticStyle:{background:"#409eff",color:"#ffffff","border-radius":"1px 1px 1px 0"},attrs:{slot:"append",type:"primary"},on:{click:t.open12},slot:"append"},[t._v(t._s(t.$t("application.preview")))])],2)],1)],1)])],1),t._v(" "),r("el-divider",[r("b",[t._v(t._s(t.$t("application.applicationconfiguration")))])]),t._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"},[r("el-form-item",{attrs:{label:t.$t("application.applicationaccessscale"),prop:"scale",rules:[{required:!0,message:"请选择应用接入规模",trigger:"change"}]}},[r("el-select",{attrs:{clearable:""},model:{value:t.form.scale,callback:function(e){t.$set(t.form,"scale",t._n(e))},expression:"form.scale"}},t._l(t.form.scaleDate,function(t){return r("el-option",{key:t.id,attrs:{label:t.label,value:t.value}})}))],1)],1)])],1)],1),t._v(" "),r("div",{staticClass:"btns"},[r("el-button",{directives:[{name:"show",rawName:"v-show",value:"add"==t.page,expression:"page=='add'"}],attrs:{type:"primary"},on:{click:t.handleClickSubmit}},[t._v(t._s(t.$t("application.submission")))]),t._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:"update"==t.page,expression:"page=='update'"}],attrs:{type:"primary"},on:{click:t.handleClickUpdate}},[t._v(t._s(t.$t("application.submission")))])],1)],1)])},[],!1,null,"3db6e6eb",null);d.options.__file="addApp.vue";e.default=d.exports},r0eq:function(t,e,r){}}]);